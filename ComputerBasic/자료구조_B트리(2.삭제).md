### B-Tree 데이터 삭제

## 1. 삭제의 기본 원칙

1. **리프 노드에서의 삭제**:
   - B-Tree의 데이터 삭제는 항상 리프 노드에서 이루어집니다.
   - 만약 삭제 대상이 리프 노드가 아니라면, 해당 데이터를 리프 노드로 옮긴 후 삭제합니다.

2. **최소 키 조건 만족**:
   - 노드가 데이터를 삭제한 후 최소 키 수를 만족하지 못하면 트리의 재조정이 필요합니다.
   - 최소 키 수:
     - `⌈M/2⌉ - 1` (M: 노드의 최대 자식 수)

3. **재조정 방식**:
   - 형제 노드로부터 키를 빌림.
   - 형제와 병합.
   - 부모 노드에서 문제 해결 재귀적으로 수행.

---

## 2. 삭제 단계

### 단계 1: 리프 노드에서 삭제
- 데이터를 삭제한 후 노드의 키 수가 최소 키 수보다 작아지지 않으면 삭제 완료.

### 단계 2: 리프 노드로 데이터 이동
- 삭제 대상이 리프 노드가 아닐 경우, **선임자(predecessor)** 또는 **후임자(successor)**와 데이터를 교환.
- 선임자:
  - 삭제 대상의 왼쪽 서브트리에서 가장 큰 값.
- 후임자:
  - 삭제 대상의 오른쪽 서브트리에서 가장 작은 값.

### 단계 3: 트리 재조정
- 키 수가 최소 키 수를 만족하지 않는 경우 재조정 수행.

#### 1. 형제 노드로부터 키 빌리기
- 형제 노드의 키 수가 여유가 있을 경우:
  - 부모 노드의 키를 재배치하여 형제 노드로부터 키를 빌림.
  - 정렬 상태를 유지하도록 부모-형제 노드 간 키 교환.

#### 2. 형제 노드와 병합
- 형제 노드의 키 수가 여유가 없을 경우:
  - 부모 노드의 키와 문제 발생 노드를 병합.
  - 병합된 노드의 키 수가 최소 조건을 만족하지 않으면 부모 노드에서 재조정 수행.

---

## 3. 예시: 3차 B-Tree 데이터 삭제

### 초기 상태 (M=3, 최대 키 수=2):
```
        [10]
       /    \
   [5, 7]    [20, 25]
  /  |  \         |  \
[3] [6] [8]    [22] [30]
```

---

### **1. 6 삭제**
- **6**은 리프 노드에서 삭제됩니다.
- 삭제 후 **[5, 7]**은 최소 조건(1개 키)을 만족하므로 재조정이 필요 없습니다.
```
        [10]
       /    \
   [5, 7]    [20, 25]
  /  |  \         |  \
[3] [ ] [8]    [22] [30]
```

---

### **2. 리프 노드 재조정**
- 리프 노드가 비어 있는 **[ ]** 상태는 허용되지 않습니다.
- **형제 노드와 병합** 또는 **형제 노드로부터 키를 빌림**을 통해 리프 노드 상태를 수정합니다.

1. **[5, 7]**에서 **7**을 내려주고, **8**을 리프 노드로 이동합니다.
```
        [10]
       /    \
   [5]       [20, 25]
  /   \         |  \
[3]   [7, 8]  [22] [30]
```

---

### **3. 7 삭제**
- **7**은 리프 노드에서 삭제됩니다.
- **[7, 8]** → **[8]**으로 변환됩니다. 이 상태는 최소 조건(1개 키)을 만족하므로 추가 재조정은 필요 없습니다.
```
        [10]
       /    \
   [5]       [20, 25]
  /   \         |  \
[3]   [8]     [22] [30]
```

---

### **4. 20 삭제**
- **20**은 리프 노드가 아니므로 **후임자(22)**와 위치를 교환하여 리프 노드에서 삭제합니다.

1. **20**과 **22**를 교환:
```
        [10]
       /    \
   [5]       [22, 25]
  /   \         |  \
[3]   [8]     [20] [30]
```

2. 리프 노드의 **20**을 삭제:
```
        [10]
       /    \
   [5]       [22, 25]
  /   \             \
[3]   [8]          [30]
```

---

### **5. 5 삭제**
- **5**는 리프 노드에서 삭제됩니다.
- 삭제 후 왼쪽 하위 트리에 최소 키 수 미만의 키가 발생합니다.
- 부모 노드에서 키를 내려받고 형제 노드와 병합합니다.

1. **[10]**에서 키를 내려받고 **[3, 8]**로 병합:
```
        [22]
       /    \
   [3, 8]    [25, 30]
```

---

### 최종 상태
- 삭제가 완료된 후, B-트리는 다음과 같은 형태를 갖습니다:
```
        [22]
       /    \
   [3, 8]    [25, 30]
```

---

## 4. 삭제 후 트리 특성 유지
- 모든 리프 노드는 동일한 깊이에 위치.
- 각 노드는 최소 키 수 조건을 만족.
- B-Tree의 정렬 상태와 균형 상태가 유지됨.

---

## 5. B-Tree 삭제의 요약
1. 데이터 삭제는 항상 리프 노드에서 발생.
2. 리프 노드가 아닐 경우, 선임자 또는 후임자와 데이터를 교환하여 리프 노드로 이동 후 삭제.
3. 최소 키 수 조건을 만족하지 않을 경우 재조정 수행:
   - 형제 노드로부터 키를 빌림.
   - 형제 노드와 병합.
   - 부모 노드에서 재조정 수행.
