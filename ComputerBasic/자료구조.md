# B-Tree

## 1. B-Tree의 개념과 BST와의 관계

### BST(이진 탐색 트리)의 특징
- 모든 노드의 왼쪽 서브트리: 해당 노드의 값보다 작은 값들로만 구성
- 모든 노드의 오른쪽 서브트리: 해당 노드의 값보다 큰 값들로만 구성
- 각 노드는 최대 2개의 자식 노드를 가짐

### B-Tree의 확장
B-Tree는 BST를 일반화한 트리 구조로, 다음과 같은 특징을 가집니다:
- 노드당 자식 노드의 최대 개수를 늘릴 수 있음
- 하나의 노드에 여러 개의 키를 저장할 수 있음
- 모든 키는 노드 내에서 오름차순으로 정렬됨

## 2. B-Tree의 주요 특성

### M차 B-Tree의 규칙
- M: 각 노드의 최대 자녀 노드 수
- 최대 키 수: M-1
- 최소 자녀 노드 수: ⌈M/2⌉ (루트 노드와 리프 노드 제외)
- 최소 키 수: ⌈M/2⌉-1 (루트 노드 제외)

### 중요한 특징
1. internal 노드의 키가 x개일 때, 자녀 노드 수는 항상 x+1개
2. 모든 internal 노드는 최소 2개의 자녀를 가짐
3. 모든 리프 노드는 같은 레벨에 위치 (Balanced Tree)
4. 검색 시간 복잡도: 평균 및 최악의 경우 모두 O(logN)

## 3. B-Tree 데이터 삽입 과정

### 삽입 규칙
1. 새로운 키는 항상 리프 노드에 삽입
2. 노드가 최대 키 수를 초과하면:
   - 중간(median) 키를 기준으로 분할
   - 중간 키는 부모 노드로 승진
   - 나머지 키들은 좌우로 분할

### 3차 B-Tree 삽입 예시

1. 초기 상태:
```
|1|
```

2. 15 삽입:
```
|1|15|
```

3. 2 삽입 후 분할:
```
    |2|
   /   \
|1|    |15|
```

4. 5 삽입:
```
    |2|
   /   \
|1|    |5|15|
```

5. 30 삽입:
```
    |2|
   /   \
|1|    |5|15|30|   <- 노드가 넘침
```

분할 후:
```
      |2|15|
     /  |   \
|1|    |5|   |30|
```

6. 90 삽입:
```
      |2|15|
     /  |   \
|1|    |5|   |30|90|
```

7. 20 삽입:
```
      |2|15|
     /  |   \
|1|    |5|   |20|30|90|   <- 노드가 넘침
```

첫 분할 후:
```
      |2|15|30|   <- 루트 노드가 넘침
     /  |    |  \
|1|    |5|  |20|  |90|
```

최종 분할 후:
```
        |15|
       /    \
    |2|     |30|
   /  \     /   \
|1|  |5|  |20|  |90|
```

8. 7 삽입:
```
        |15|
       /    \
    |2|     |30|
   /  \     /   \
|1|  |5|7| |20|  |90|
```

9. 9 삽입:
```
        |15|
       /    \
    |2|     |30|
   /  \     /   \
|1|  |5|7|9| |20|  |90|   <- 노드가 넘침
```

분할 후:
```
           |15|
          /    \
    |2|7|      |30|
   /  |  \     /   \
|1| |5| |9|  |20|  |90|
```

## 주요 관찰사항
1. 모든 삽입은 리프 노드에서 시작됩니다.
2. 노드가 넘칠 때마다(3개 이상의 키를 포함할 때) 중간 키를 기준으로 분할이 발생합니다.
3. 분할 과정에서 중간 키가 부모 노드로 승진하며, 이는 재귀적으로 루트까지 영향을 미칠 수 있습니다.
4. 모든 과정에서 B-Tree의 특성(모든 리프가 같은 레벨에 있어야 함)이 유지됩니다.

## 4. B-Tree의 장점
1. 균형 잡힌 트리 구조로 안정적인 성능 보장
2. 디스크 기반 시스템에서 효율적
3. 노드당 여러 키를 저장할 수 있어 트리의 높이를 줄일 수 있음
4. 항상 정렬된 상태를 유지하여 범위 검색에 효율적
